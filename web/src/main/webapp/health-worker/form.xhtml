<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  template="/WEB-INF/templates/layout.xhtml"
>
  <ui:define name="title">Register Health Worker</ui:define>
  <ui:define name="content">
    <div class="card shadow-sm">
      <div class="card-body">
        <h:messages
          id="formMessages"
          globalOnly="true"
          styleClass="alert alert-danger"
          layout="list"
          infoClass="alert alert-success"
          warnClass="alert alert-warning"
          errorClass="alert alert-danger"
          fatalClass="alert alert-danger"
        />
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h2 class="card-title h4 mb-0">Register Health Worker</h2>
            <small class="text-muted"
              >Collect core information about medical professionals.</small
            >
          </div>
          <h:link
            outcome="/health-worker/list"
            styleClass="btn btn-outline-secondary"
            >Back to list</h:link
          >
        </div>

        <h:form styleClass="row g-3">
          <div class="col-md-6">
            <h:outputLabel
              for="document"
              value="Document"
              styleClass="form-label"
            />
            <h:inputText
              id="document"
              value="#{healthWorkerBean.newWorker.document}"
              required="true"
              requiredMessage="Document number is required"
              validatorMessage="Document must contain 5-30 letters or digits"
              styleClass="form-control"
              p:placeholder="Enter national ID"
              p:autocomplete="off"
            >
              <f:validateRegex pattern="^[0-9A-Za-z]{5,30}$" />
              <f:ajax
                event="blur"
                render="documentMessage"
                execute="document"
              />
            </h:inputText>
            <h:message
              id="documentMessage"
              for="document"
              styleClass="form-text text-danger"
            />
          </div>
          <div class="col-md-6">
            <h:outputLabel
              for="documentType"
              value="Document Type"
              styleClass="form-label"
            />
            <h:selectOneMenu
              id="documentType"
              value="#{healthWorkerBean.newWorker.documentType}"
              required="true"
              requiredMessage="Select a document type"
              styleClass="form-select"
            >
              <f:selectItem
                itemLabel="-- Select --"
                itemValue=""
                noSelectionOption="true"
              />
              <f:selectItems
                value="#{healthWorkerBean.documentTypes}"
                var="type"
                itemValue="#{type}"
                itemLabel="#{type}"
              />
              <f:ajax
                event="change"
                render="documentTypeMessage"
                execute="documentType"
              />
            </h:selectOneMenu>
            <h:message
              id="documentTypeMessage"
              for="documentType"
              styleClass="form-text text-danger"
            />
          </div>

          <div class="col-sm-6">
            <h:outputLabel
              for="firstName"
              value="First Name"
              styleClass="form-label"
            />
            <h:inputText
              id="firstName"
              value="#{healthWorkerBean.newWorker.firstName}"
              required="true"
              requiredMessage="First name is required"
              styleClass="form-control"
              p:placeholder="Enter given name"
              p:autocomplete="given-name"
              p:minlength="2"
              p:maxlength="60"
            >
              <f:ajax
                event="blur"
                render="firstNameMessage"
                execute="firstName"
              />
            </h:inputText>
            <h:message
              id="firstNameMessage"
              for="firstName"
              styleClass="form-text text-danger"
            />
          </div>
          <div class="col-sm-6">
            <h:outputLabel
              for="lastName"
              value="Last Name"
              styleClass="form-label"
            />
            <h:inputText
              id="lastName"
              value="#{healthWorkerBean.newWorker.lastName}"
              required="true"
              requiredMessage="Last name is required"
              styleClass="form-control"
              p:placeholder="Enter family name"
              p:autocomplete="family-name"
              p:minlength="2"
              p:maxlength="60"
            >
              <f:ajax
                event="blur"
                render="lastNameMessage"
                execute="lastName"
              />
            </h:inputText>
            <h:message
              id="lastNameMessage"
              for="lastName"
              styleClass="form-text text-danger"
            />
          </div>

          <div class="col-sm-6">
            <h:outputLabel
              for="dob"
              value="Date of Birth"
              styleClass="form-label"
            />
            <h:inputText
              id="dob"
              value="#{healthWorkerBean.newWorker.dateOfBirth}"
              required="true"
              requiredMessage="Date of birth is required"
              styleClass="form-control"
              p:placeholder="YYYY-MM-DD"
              p:type="date"
              p:max="#{healthWorkerBean.maxAdultBirthDate}"
            >
              <f:convertDateTime type="localDate" pattern="yyyy-MM-dd" />
              <f:ajax event="change" render="dobMessage" execute="dob" />
            </h:inputText>
            <h:message
              id="dobMessage"
              for="dob"
              styleClass="form-text text-danger"
            />
          </div>
          <div class="col-sm-6">
            <h:outputLabel
              for="gender"
              value="Gender"
              styleClass="form-label"
            />
            <h:selectOneMenu
              id="gender"
              value="#{healthWorkerBean.newWorker.gender}"
              required="true"
              requiredMessage="Select a gender"
              styleClass="form-select"
            >
              <f:selectItem
                itemLabel="-- Select --"
                itemValue=""
                noSelectionOption="true"
              />
              <f:selectItems
                value="#{healthWorkerBean.genders}"
                var="gender"
                itemValue="#{gender}"
                itemLabel="#{gender}"
              />
              <f:ajax event="change" render="genderMessage" execute="gender" />
            </h:selectOneMenu>
            <h:message
              id="genderMessage"
              for="gender"
              styleClass="form-text text-danger"
            />
          </div>

          <div class="col-12">
            <h:outputLabel
              for="clinics"
              value="Clinics"
              styleClass="form-label"
            />
            <h:selectManyListbox
              id="clinics"
              value="#{healthWorkerBean.selectedClinicIds}"
              styleClass="form-select"
              size="5"
            >
              <f:selectItems
                value="#{healthWorkerBean.clinics}"
                var="clinic"
                itemValue="#{clinic.id}"
                itemLabel="#{clinic.name}"
              />
            </h:selectManyListbox>
          </div>

          <div class="col-sm-6">
            <h:outputLabel for="email" value="Email" styleClass="form-label" />
            <h:inputText
              id="email"
              value="#{healthWorkerBean.newWorker.email}"
              styleClass="form-control"
              p:type="email"
              p:placeholder="name@example.com"
              p:autocomplete="email"
            >
              <f:ajax event="blur" render="emailMessage" execute="email" />
            </h:inputText>
            <h:message
              id="emailMessage"
              for="email"
              styleClass="form-text text-danger"
            />
          </div>
          <div class="col-sm-6">
            <h:outputLabel for="phone" value="Phone" styleClass="form-label" />
            <h:inputText
              id="phone"
              value="#{healthWorkerBean.newWorker.phone}"
              styleClass="form-control"
              p:type="tel"
              p:inputmode="tel"
              p:placeholder="e.g. +598123456"
              p:pattern="^[+0-9 ()-]{7,20}$"
            >
              <f:ajax event="blur" render="phoneMessage" execute="phone" />
            </h:inputText>
            <h:message
              id="phoneMessage"
              for="phone"
              styleClass="form-text text-danger"
            />
          </div>

          <div class="col-12">
            <h:outputLabel
              for="address"
              value="Address"
              styleClass="form-label"
            />
            <h:inputText
              id="address"
              value="#{healthWorkerBean.newWorker.address}"
              styleClass="form-control"
              p:placeholder="Street, number, city"
              p:autocomplete="street-address"
            >
              <f:ajax event="blur" render="addressMessage" execute="address" />
            </h:inputText>
            <h:message
              id="addressMessage"
              for="address"
              styleClass="form-text text-danger"
            />
          </div>

          <div class="col-sm-6">
            <h:outputLabel
              for="password"
              value="Password"
              styleClass="form-label"
            />
            <h:inputSecret
              id="password"
              value="#{healthWorkerBean.newWorker.password}"
              required="true"
              requiredMessage="Password is required"
              redisplay="false"
              styleClass="form-control"
              p:placeholder="Minimum 8 characters"
              p:autocomplete="new-password"
            >
              <f:validateLength minimum="8" />
              <f:ajax
                event="blur"
                render="passwordMessage"
                execute="password"
              />
            </h:inputSecret>
            <h:message
              id="passwordMessage"
              for="password"
              styleClass="form-text text-danger"
            />
          </div>
          <div class="col-sm-6">
            <h:outputLabel
              for="license"
              value="License Number"
              styleClass="form-label"
            />
            <h:inputText
              id="license"
              value="#{healthWorkerBean.newWorker.licenseNumber}"
              required="true"
              requiredMessage="License number is required"
              validatorMessage="License must be 4-30 alphanumeric characters"
              styleClass="form-control"
              p:placeholder="Enter professional license"
            >
              <f:validateRegex pattern="^[0-9A-Za-z-]{4,30}$" />
              <f:ajax event="blur" render="licenseMessage" execute="license" />
            </h:inputText>
            <h:message
              id="licenseMessage"
              for="license"
              styleClass="form-text text-danger"
            />
          </div>

          <div class="col-12 d-flex gap-2 mt-3">
            <h:commandButton
              value="Save"
              action="#{healthWorkerBean.save}"
              styleClass="btn btn-primary"
            />
            <h:commandButton
              value="Reset"
              actionListener="#{healthWorkerBean.init}"
              immediate="true"
              styleClass="btn btn-outline-secondary"
            >
              <f:ajax render="@form" />
            </h:commandButton>
          </div>
        </h:form>
      </div>
    </div>
  </ui:define>
</ui:composition>
