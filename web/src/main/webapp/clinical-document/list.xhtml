<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Clinical Documents</title>
    <meta charset="UTF-8"/>
    <style>
        body{font-family:sans-serif;max-width:1200px;margin:24px auto;padding:0 16px}
        .btn{display:inline-block;padding:6px 12px;background:#1976d2;color:#fff;text-decoration:none;border-radius:4px;border:none;margin-right:8px}
        .btn:hover{background:#125aa0}
        table{width:100%;border-collapse:collapse;margin:16px 0}
        th,td{border:1px solid #ddd;padding:8px;text-align:left}
        th{background:#f5f5f5}
        .toolbar{margin:12px 0}
        .toolbar input{margin-right:8px;padding:6px}
    </style>
</h:head>
<h:body>
    <h1>Clinical Documents</h1>
    <h:messages id="msgs" globalOnly="true"/>

    <h:form id="searchForm" styleClass="toolbar">
        <h:inputText id="q" value="#{clinicalDocumentBean.searchQuery}" placeholder="Search by patient/author/provider name">
            <f:ajax event="keyup" listener="#{clinicalDocumentBean.search}" render="results msgs"/>
        </h:inputText>
        <h:commandButton value="Search" actionListener="#{clinicalDocumentBean.search}" styleClass="btn">
            <f:ajax render="results msgs"/>
        </h:commandButton>
        <h:commandButton value="Refresh" actionListener="#{clinicalDocumentBean.loadAll}" styleClass="btn">
            <f:ajax render="results msgs"/>
        </h:commandButton>
        <h:link outcome="/clinical-document/form" value="Add Document" styleClass="btn"/>
        <h:link outcome="/index" value="Home" styleClass="btn"/>
    </h:form>

    <h:panelGroup id="results">
        <h:dataTable value="#{clinicalDocumentBean.documents}" var="d" rendered="#{not empty clinicalDocumentBean.documents}">
            <h:column><f:facet name="header">UUID</f:facet>#{d.id}</h:column>
            <h:column><f:facet name="header">Title</f:facet>#{d.title}</h:column>
            <h:column><f:facet name="header">Issued</f:facet>#{d.issuedAt}</h:column>
            <h:column><f:facet name="header">Patient</f:facet>#{d.clinicalHistory != null and d.clinicalHistory.patient != null ? d.clinicalHistory.patient.lastName.concat(', ').concat(d.clinicalHistory.patient.firstName) : '-'}</h:column>
            <h:column><f:facet name="header">Author</f:facet>#{d.author != null ? d.author.lastName.concat(', ').concat(d.author.firstName) : '-'}</h:column>
            <h:column><f:facet name="header">Provider</f:facet>#{d.provider != null ? d.provider.name : '-'}</h:column>
        </h:dataTable>
        
        <h:panelGroup rendered="#{empty clinicalDocumentBean.documents}">
            <p>No clinical documents found.</p>
        </h:panelGroup>
    </h:panelGroup>
</h:body>
</html>
